
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Class cartridge.test-helpers.cluster &#8212; Cartridge 2.1.2 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Class cartridge.test-helpers.server" href="cartridge.test-helpers.server.html" />
    <link rel="prev" title="Module cartridge.lua-api.deprecated" href="../modules/cartridge.lua-api.deprecated.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="class-cartridge-test-helpers-cluster">
<span id="cartridge-test-helpers-cluster"></span><h1>Class <em>cartridge.test-helpers.cluster</em><a class="headerlink" href="#class-cartridge-test-helpers-cluster" title="Permalink to this headline">¶</a></h1>
<p>Class to run and manage multiple tarantool instances.</p>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cluster-new-object">
<span id="cartridge-test-helpers-cluster-cluster-new"></span><h3>Cluster:new (object)<a class="headerlink" href="#cluster-new-object" title="Permalink to this headline">¶</a></h3>
<p>Build cluster object.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>object:</em></p>
<ul>
<li><p><em>datadir:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Data directory for all cluster servers.</p></li>
<li><p><em>server_command:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Command to run server.</p></li>
<li><p><em>cookie:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Cluster cookie.</p></li>
<li><p><em>base_http_port:</em> (<strong>int</strong>) Value to calculate server’s http_port. (optional)</p></li>
<li><p><em>base_advertise_port:</em> (<strong>int</strong>) Value to calculate server’s advertise_port. (optional)</p></li>
<li><p><em>use_vshard:</em> (<strong>bool</strong>) bootstrap vshard after server is started. (optional)</p></li>
<li><p><em>replicasets:</em> (<strong>tab</strong>) Replicasets configuration. List of <a class="reference internal" href="#cartridge-test-helpers-cluster-cartridge-test-helpers-cluster-replicaset-config"><span class="std std-ref">replicaset_config</span></a></p></li>
<li><p><em>failover:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Failover mode: disabled, eventual, or stateful. (optional)</p></li>
<li><p><em>stateboard_entrypoint:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Command to run stateboard. (optional)</p></li>
<li><p><em>zone_distances:</em> (<strong>tab</strong>) Vshard distances between zones. (optional)</p></li>
<li><p><em>swim_period:</em> (<strong>number</strong>) SWIM protocol period in seconds. (optional)</p></li>
</ul>
</li>
</ul>
<p><strong>Returns</strong>:</p>
<p>object</p>
</div>
<div class="section" id="cluster-server-alias">
<span id="cartridge-test-helpers-cluster-cluster-server"></span><h3>Cluster:server (alias)<a class="headerlink" href="#cluster-server-alias" title="Permalink to this headline">¶</a></h3>
<p>Find server by alias.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>alias:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>)</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<p><a class="reference internal" href="cartridge.test-helpers.server.html#cartridge-test-helpers-server"><span class="std std-ref">cartridge.test-helpers.server</span></a></p>
</div>
<div class="section" id="cluster-server-by-role-role-name">
<span id="cartridge-test-helpers-cluster-cluster-server-by-role"></span><h3>Cluster:server_by_role (role_name)<a class="headerlink" href="#cluster-server-by-role-role-name" title="Permalink to this headline">¶</a></h3>
<p>Find server by role name.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>role_name:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>)</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<p><a class="reference internal" href="cartridge.test-helpers.server.html#cartridge-test-helpers-server"><span class="std std-ref">cartridge.test-helpers.server</span></a></p>
</div>
<div class="section" id="cluster-servers-by-role-role-name">
<span id="cartridge-test-helpers-cluster-cluster-servers-by-role"></span><h3>Cluster:servers_by_role (role_name)<a class="headerlink" href="#cluster-servers-by-role-role-name" title="Permalink to this headline">¶</a></h3>
<p>Return list of servers with enabled role by role name</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>role_name:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>)</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<p><a class="reference internal" href="cartridge.test-helpers.server.html#cartridge-test-helpers-server"><span class="std std-ref">cartridge.test-helpers.server</span></a></p>
</div>
<div class="section" id="cluster-apply-topology">
<span id="cartridge-test-helpers-cluster-cluster-apply-topology"></span><h3>Cluster:apply_topology ()<a class="headerlink" href="#cluster-apply-topology" title="Permalink to this headline">¶</a></h3>
<p>Execute  <code class="docutils literal notranslate"><span class="pre">edit_topology</span></code>  GraphQL request to setup replicasets, apply roles
join servers to replicasets.</p>
</div>
<div class="section" id="cluster-start">
<span id="cartridge-test-helpers-cluster-cluster-start"></span><h3>Cluster:start ()<a class="headerlink" href="#cluster-start" title="Permalink to this headline">¶</a></h3>
<p>Bootstraps cluster if it wasn’t bootstrapped before.  Otherwise starts servers.</p>
</div>
<div class="section" id="cluster-stop">
<span id="cartridge-test-helpers-cluster-cluster-stop"></span><h3>Cluster:stop ()<a class="headerlink" href="#cluster-stop" title="Permalink to this headline">¶</a></h3>
<p>Stop all servers.</p>
</div>
<div class="section" id="cluster-join-server-server">
<span id="cartridge-test-helpers-cluster-cluster-join-server"></span><h3>Cluster:join_server (server)<a class="headerlink" href="#cluster-join-server-server" title="Permalink to this headline">¶</a></h3>
<p>Register running server in the cluster.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>server:</em> (<strong>Server</strong>) Server to be registered.</p></li>
</ul>
</div>
<div class="section" id="cluster-wait-until-healthy-server">
<span id="cartridge-test-helpers-cluster-cluster-wait-until-healthy"></span><h3>Cluster:wait_until_healthy (server)<a class="headerlink" href="#cluster-wait-until-healthy-server" title="Permalink to this headline">¶</a></h3>
<p>Blocks fiber until  <code class="docutils literal notranslate"><span class="pre">cartridge.is_healthy()</span></code>  returns true on main_server.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>server:</em></p></li>
</ul>
</div>
<div class="section" id="cluster-upload-config-config-opts">
<span id="cartridge-test-helpers-cluster-cluster-upload-config"></span><h3>Cluster:upload_config (config, opts)<a class="headerlink" href="#cluster-upload-config-config-opts" title="Permalink to this headline">¶</a></h3>
<p>Upload application config, shortcut for  <code class="docutils literal notranslate"><span class="pre">cluster.main_server:upload_config(config)</span></code> .</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>config:</em></p></li>
<li><p><em>opts:</em></p></li>
</ul>
<p><strong>See also:</strong></p>
<ul class="simple">
<li><p>cartridge.test-helpers.server.Server:upload_config</p></li>
</ul>
</div>
<div class="section" id="cluster-download-config">
<span id="cartridge-test-helpers-cluster-cluster-download-config"></span><h3>Cluster:download_config ()<a class="headerlink" href="#cluster-download-config" title="Permalink to this headline">¶</a></h3>
<p>Download application config, shortcut for  <code class="docutils literal notranslate"><span class="pre">cluster.main_server:download_config()</span></code> .</p>
<p><strong>See also:</strong></p>
<ul class="simple">
<li><p>cartridge.test-helpers.server.Server:download_config</p></li>
</ul>
</div>
<div class="section" id="cluster-retrying-config-fn">
<span id="cartridge-test-helpers-cluster-cluster-retrying"></span><h3>Cluster:retrying (config, fn[, …])<a class="headerlink" href="#cluster-retrying-config-fn" title="Permalink to this headline">¶</a></h3>
<p>Keeps calling fn until it returns without error.
Throws last error if config.timeout is elapsed.</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>config:</em> (<strong>tab</strong>) Options for  <code class="docutils literal notranslate"><span class="pre">luatest.helpers.retrying</span></code> .</p></li>
<li><p><em>fn:</em> (<strong>func</strong>) Function to call</p></li>
<li><p><em>…:</em>  Args to run fn with. (optional)</p></li>
</ul>
</div>
</div>
<div class="section" id="tables">
<h2>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cartridge-test-helpers-cluster-replicaset-config">
<span id="cartridge-test-helpers-cluster-cartridge-test-helpers-cluster-replicaset-config"></span><h3>cartridge.test-helpers.cluster.replicaset_config<a class="headerlink" href="#cartridge-test-helpers-cluster-replicaset-config" title="Permalink to this headline">¶</a></h3>
<p>Replicaset config.</p>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><em>alias:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Prefix to generate server alias automatically. (optional)</p></li>
<li><p><em>uuid:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Replicaset uuid. (optional)</p></li>
<li><p><em>roles:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">{string}</a>) List of roles for servers in the replicaset.</p></li>
<li><p><em>vshard_group:</em> (optional <a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a>) Name of vshard group.</p></li>
<li><p><em>weight:</em> (optional <strong>number</strong>) Vshard group weight.</p></li>
<li><p><em>all_rw:</em> (optional <strong>boolean</strong>) Make all replicas writable.</p></li>
<li><p><em>servers:</em> (<a class="reference external" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a> or <strong>number</strong>) List of objects to build  <code class="docutils literal notranslate"><span class="pre">Server</span></code> s with or.. code-block:: lua       number of servers in replicaset.</p></li>
</ul>
</div>
</div>
<div class="section" id="local-functions">
<h2>Local Functions<a class="headerlink" href="#local-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cartridge-test-helpers-cluster-iter-servers-by-role-cluster-role-name">
<span id="cartridge-test-helpers-cluster-cartridge-test-helpers-cluster-iter-servers-by-role"></span><h3>cartridge.test-helpers.cluster.iter_servers_by_role (cluster, role_name)<a class="headerlink" href="#cartridge-test-helpers-cluster-iter-servers-by-role-cluster-role-name" title="Permalink to this headline">¶</a></h3>
<p>Return iterator for cluster server’s with enabled role</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><em>cluster:</em></p></li>
<li><p><em>role_name:</em></p></li>
</ul>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Cartridge</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cartridge_dev.html">Developer’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cartridge_admin.html">Administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Cartridge API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.html">Module <em>cartridge</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.auth.html">Module <em>cartridge.auth</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.roles.html">Module <em>cartridge.roles</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.issues.html">Module <em>cartridge.issues</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.argparse.html">Module <em>cartridge.argparse</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.twophase.html">Module <em>cartridge.twophase</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.failover.html">Module <em>cartridge.failover</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.topology.html">Module <em>cartridge.topology</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.clusterwide-config.html">Module <em>cartridge.clusterwide-config</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.rpc.html">Module <em>cartridge.rpc</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.tar.html">Module <em>cartridge.tar</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.pool.html">Module <em>cartridge.pool</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.upload.html">Module <em>cartridge.upload</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.confapplier.html">Module <em>cartridge.confapplier</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.remote-control.html">Module <em>cartridge.remote-control</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.service-registry.html">Module <em>cartridge.service-registry</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/custom-role.html">Module <em>custom-role</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.stat.html">Module <em>cartridge.lua-api.stat</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.boxinfo.html">Module <em>cartridge.lua-api.boxinfo</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.get-topology.html">Module <em>cartridge.lua-api.get-topology</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.edit-topology.html">Module <em>cartridge.lua-api.edit-topology</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.topology.html">Module <em>cartridge.lua-api.topology</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.failover.html">Module <em>cartridge.lua-api.failover</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.vshard.html">Module <em>cartridge.lua-api.vshard</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/cartridge.lua-api.deprecated.html">Module <em>cartridge.lua-api.deprecated</em></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Class <em>cartridge.test-helpers.cluster</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="cartridge.test-helpers.server.html">Class <em>cartridge.test-helpers.server</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="cartridge.test-helpers.etcd.html">Class <em>cartridge.test-helpers.etcd</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="cartridge.test-helpers.stateboard.html">Class <em>cartridge.test-helpers.stateboard</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Table of contents</a><ul>
      <li>Previous: <a href="../modules/cartridge.lua-api.deprecated.html" title="previous chapter">Module <em>cartridge.lua-api.deprecated</em></a></li>
      <li>Next: <a href="cartridge.test-helpers.server.html" title="next chapter">Class <em>cartridge.test-helpers.server</em></a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../../_sources/cartridge_api/classes/cartridge.test-helpers.cluster.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>